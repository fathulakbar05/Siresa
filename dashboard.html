<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SIRESA - Admin Dashboard</title>
  <link rel="stylesheet" href="/src/output.css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="flex h-screen">
    <div class="flex-1 overflow-y-auto">
      <header
        class="bg-gray-800 text-white py-4 px-6 flex justify-between items-center"
      >
        <h1 class="text-xl font-bold">SIRESA - Admin Dashboard</h1>
        <div>
          <button
            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-full"
          >
            Admin
          </button>
        </div>
      </header>

      <div class="p-6">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <h2 class="text-xl font-bold mb-4">Ringkasan Sistem</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-blue-50 p-4 rounded-lg">
              <h3 class="font-medium text-gray-700">Permintaan Baru: <span id="jumlah-menunggu"></span></h3>
            </div>
            <div class="bg-green-50 p-4 rounded-lg">
              <h3 class="font-medium text-gray-700">Disetujui: <span id="jumlah-disetujui"></span></h3>
            </div>
            <div class="bg-red-50 p-4 rounded-lg">
              <h3 class="font-medium text-gray-700">Ditolak: <span id="jumlah-ditolak"></span></h3>
            </div>
            <div class="bg-yellow-50 p-4 rounded-lg">
              <h3 class="font-medium text-gray-700">Total Ruangan: 42</h3>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-bold mb-4">
            Seluruh Data Reservasi
          </h2>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="bg-gray-100">
                  <th class="text-left p-3">ID Reservasi</th>
                  <th class="text-left p-3">ID User</th>
                  <th class="text-left p-3">ID Ruangan</th>
                  <th class="text-left p-3">Tanggal</th>
                  <th class="text-left p-3">Jam Mulai</th>
                  <th class="text-left p-3">Jam Selesai</th>
                  <th class="text-left p-3">Status</th>
                  <th class="text-left p-3">Waktu Pengajuan</th>
                </tr>
              </thead>
              <tbody id="data-reservasi">
                </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const statusDicari = "pending"; // Contoh nilai status
      const url = `http://127.0.0.1:8080/reservasi/by-status?status=${statusDicari}`;
      fetch(url) // Mengambil semua status
        .then(response => {
          if (!response.ok) {
            throw new Error('Gagal mengambil data reservasi: ' + response.status);
          }
          return response.json();
        })
        .then(data => {
          console.log(data); // Proses data reservasi
          
          const tabelBody = document.getElementById('data-reservasi');
          tabelBody.innerHTML = ''; // Kosongkan isi tabel sebelum menambahkan data baru

          data.forEach(reservasi => {
            const row = tabelBody.insertRow();
            const idReservasiCell = row.insertCell();
            const idUserCell = row.insertCell();
            const idRuanganCell = row.insertCell();
            const tanggalCell = row.insertCell();
            const jamMulaiCell = row.insertCell();
            const jamSelesaiCell = row.insertCell();
            const statusCell = row.insertCell();
            const waktuPengajuanCell = row.insertCell();

            idReservasiCell.textContent = reservasi.IDReservasi;
            idUserCell.textContent = reservasi.IDUser;
            idRuanganCell.textContent = reservasi.IDRuangan;
            tanggalCell.textContent = reservasi.Tanggal;
            jamMulaiCell.textContent = reservasi.JamMulai;
            jamSelesaiCell.textContent = reservasi.JamSelesai;
            statusCell.textContent = reservasi.Status;
            waktuPengajuanCell.textContent = new Date(reservasi.WaktuPengajuan).toLocaleString();
          });

          // Hitung dan tampilkan ringkasan
          const jumlahMenunggu = data.filter(r => r.Status === 'menunggu').length;
          const jumlahDisetujui = data.filter(r => r.Status === 'disetujui').length;
          const jumlahDitolak = data.filter(r => r.Status === 'ditolak').length;

          document.getElementById('jumlah-menunggu').textContent = jumlahMenunggu;
          document.getElementById('jumlah-disetujui').textContent = jumlahDisetujui;
          document.getElementById('jumlah-ditolak').textContent = jumlahDitolak;

        })
        .catch(error => {
          console.error('Error:', error);
          const tabelBody = document.getElementById('data-reservasi');
          tabelBody.innerHTML = '<tr><td colspan="8" class="p-3 text-center text-red-500">' + error + '</td></tr>';
        });
    });
  </script>
</body>
</html>